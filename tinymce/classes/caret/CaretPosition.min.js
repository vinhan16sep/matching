define("tinymce/caret/CaretPosition",["tinymce/util/Fun","tinymce/dom/NodeType","tinymce/dom/DOMUtils","tinymce/dom/RangeUtils","tinymce/caret/CaretCandidate","tinymce/geom/ClientRect","tinymce/text/ExtendingChar"],function(c,d,r,u,p,b,i){var n=d.isElement,k=p.isCaretCandidate,g=d.matchStyleValues("display","block table"),v=d.matchStyleValues("float","left right"),f=c.and(n,k,c.negate(v)),m=c.negate(d.matchStyleValues("white-space","pre pre-line pre-wrap")),j=d.isText,e=d.isBr,q=r.nodeIndex,o=u.getNode;function t(w){return"createRange" in w?w.createRange():r.DOM.createRng()}function h(w){return w&&/[\r\n\t ]/.test(w)}function s(x){var w=x.startContainer,z=x.startOffset,y;if(h(x.toString())&&m(w.parentNode)){y=w.data;if(h(y[z-1])||h(y[z+1])){return true}}return false}function l(A){var z=[],C,w;function y(K){var J=K.ownerDocument,H=t(J),G=J.createTextNode("\u00a0"),F=K.parentNode,I;F.insertBefore(G,K);H.setStart(G,0);H.setEnd(G,1);I=b.clone(H.getBoundingClientRect());F.removeChild(G);return I}function x(G){var H,F;F=G.getClientRects();if(F.length>0){H=b.clone(F[0])}else{H=b.clone(G.getBoundingClientRect())}if(e(G)&&H.left===0){return y(G)}return H}function B(G,F){G=b.collapse(G,F);G.width=1;G.right=G.left+1;return G}function D(F){if(F.height===0){return}if(z.length>0){if(b.isEqual(F,z[z.length-1])){return}}z.push(F)}function E(F,H){var G=t(F.ownerDocument);if(H<F.data.length){if(i.isExtendingChar(F.data[H])){return z}if(i.isExtendingChar(F.data[H-1])){G.setStart(F,H);G.setEnd(F,H+1);if(!s(G)){D(B(x(G),false));return z}}}if(H>0){G.setStart(F,H-1);G.setEnd(F,H);if(!s(G)){D(B(x(G),false))}}if(H<F.data.length){G.setStart(F,H);G.setEnd(F,H+1);if(!s(G)){D(B(x(G),true))}}}if(j(A.container())){E(A.container(),A.offset());return z}if(n(A.container())){if(A.isAtEnd()){w=o(A.container(),A.offset());if(j(w)){E(w,w.data.length)}if(f(w)&&!e(w)){D(B(x(w),false))}}else{w=o(A.container(),A.offset());if(j(w)){E(w,0)}if(f(w)&&A.isAtEnd()){D(B(x(w),false));return z}C=o(A.container(),A.offset()-1);if(f(C)&&!e(C)){if(g(C)||g(w)||!f(w)){D(B(x(C),false))}}if(f(w)){D(B(x(w),true))}}}return z}function a(w,z,C){function B(){if(j(w)){return z===0}return z===0}function D(){if(j(w)){return z>=w.data.length}return z>=w.childNodes.length}function y(){var G;G=t(w.ownerDocument);G.setStart(w,z);G.setEnd(w,z);return G}function F(){if(!C){C=l(new a(w,z))}return C}function A(){return F().length>0}function E(G){return G&&w===G.container()&&z===G.offset()}function x(G){return o(w,G?z-1:z)}return{container:c.constant(w),offset:c.constant(z),toRange:y,getClientRects:F,isVisible:A,isAtStart:B,isAtEnd:D,isEqual:E,getNode:x}}a.fromRangeStart=function(w){return new a(w.startContainer,w.startOffset)};a.fromRangeEnd=function(w){return new a(w.endContainer,w.endOffset)};a.after=function(w){return new a(w.parentNode,q(w)+1)};a.before=function(w){return new a(w.parentNode,q(w))};return a});