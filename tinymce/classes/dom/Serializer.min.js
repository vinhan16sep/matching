define("tinymce/dom/Serializer",["tinymce/dom/DOMUtils","tinymce/html/DomParser","tinymce/html/SaxParser","tinymce/html/Entities","tinymce/html/Serializer","tinymce/html/Node","tinymce/html/Schema","tinymce/Env","tinymce/util/Tools","tinymce/text/Zwsp"],function(j,o,m,d,i,g,f,h,c,e){var l=c.each,b=c.trim;var n=j.DOM,a=["data-mce-selected"];function k(q){var s,r;function p(t){return t&&t.name==="br"}s=q.lastChild;if(p(s)){r=s.prev;if(p(r)){s.remove();r.remove()}}}return function(t,s){var w,u,q;if(s){w=s.dom;u=s.schema}function r(x){var y=new RegExp(["<span[^>]+data-mce-bogus[^>]+>[\u200B\uFEFF]+<\\/span>","\\s?("+a.join("|")+')="[^"]+"'].join("|"),"gi");x=e.trim(x.replace(y,""));return x}function p(){var C=s.getBody().innerHTML;var A=/<(\w+) [^>]*data-mce-bogus="all"[^>]*>/g;var x,y,E,D,z,B=s.schema;C=r(C);z=B.getShortEndedElements();while((D=A.exec(C))){y=A.lastIndex;E=D[0].length;if(z[D[1]]){x=y}else{x=m.findEndTag(B,C,y)}C=C.substring(0,y-E)+C.substring(x);A.lastIndex=y-E}return b(C)}function v(x){if(c.inArray(a,x)===-1){q.addAttributeFilter(x,function(y,z){var A=y.length;while(A--){y[A].attr(z,null)}});a.push(x)}}w=w||n;u=u||new f(t);t.entity_encoding=t.entity_encoding||"named";t.remove_trailing_brs="remove_trailing_brs" in t?t.remove_trailing_brs:true;q=new o(t,u);q.addAttributeFilter("data-mce-tabindex",function(x,y){var z=x.length,A;while(z--){A=x[z];A.attr("tabindex",A.attributes.map["data-mce-tabindex"]);A.attr(y,null)}});q.addAttributeFilter("src,href,style",function(y,x){var C=y.length,z,E,B="data-mce-"+x;var D=t.url_converter,F=t.url_converter_scope,A;while(C--){z=y[C];E=z.attributes.map[B];if(E!==A){z.attr(x,E.length>0?E:null);z.attr(B,null)}else{E=z.attributes.map[x];if(x==="style"){E=w.serializeStyle(w.parseStyle(E),z.name)}else{if(D){E=D.call(F,E,x,z.name)}}z.attr(x,E.length>0?E:null)}}});q.addAttributeFilter("class",function(x){var y=x.length,z,A;while(y--){z=x[y];A=z.attr("class");if(A){A=z.attr("class").replace(/(?:^|\s)mce-item-\w+(?!\S)/g,"");z.attr("class",A.length>0?A:null)}}});q.addAttributeFilter("data-mce-type",function(x,z,y){var A=x.length,B;while(A--){B=x[A];if(B.attributes.map["data-mce-type"]==="bookmark"&&!y.cleanup){B.remove()}}});q.addNodeFilter("noscript",function(x){var y=x.length,z;while(y--){z=x[y].firstChild;if(z){z.value=d.decode(z.value)}}});q.addNodeFilter("script,style",function(y,z){var A=y.length,C,D,B;function x(E){return E.replace(/(<!--\[CDATA\[|\]\]-->)/g,"\n").replace(/^[\r\n]*|[\r\n]*$/g,"").replace(/^\s*((<!--)?(\s*\/\/)?\s*<!\[CDATA\[|(<!--\s*)?\/\*\s*<!\[CDATA\[\s*\*\/|(\/\/)?\s*<!--|\/\*\s*<!--\s*\*\/)\s*[\r\n]*/gi,"").replace(/\s*(\/\*\s*\]\]>\s*\*\/(-->)?|\s*\/\/\s*\]\]>(-->)?|\/\/\s*(-->)?|\]\]>|\/\*\s*-->\s*\*\/|\s*-->\s*)\s*$/g,"")}while(A--){C=y[A];D=C.firstChild?C.firstChild.value:"";if(z==="script"){B=C.attr("type");if(B){C.attr("type",B=="mce-no/type"?null:B.replace(/^mce\-/,""))}if(D.length>0){C.firstChild.value="// <![CDATA[\n"+x(D)+"\n// ]]>"}}else{if(D.length>0){C.firstChild.value="<!--\n"+x(D)+"\n-->"}}}});q.addNodeFilter("#comment",function(x){var y=x.length,z;while(y--){z=x[y];if(z.value.indexOf("[CDATA[")===0){z.name="#cdata";z.type=4;z.value=z.value.replace(/^\[CDATA\[|\]\]$/g,"")}else{if(z.value.indexOf("mce:protected ")===0){z.name="#text";z.type=3;z.raw=true;z.value=unescape(z.value).substr(14)}}}});q.addNodeFilter("xml:namespace,input",function(x,y){var z=x.length,A;while(z--){A=x[z];if(A.type===7){A.remove()}else{if(A.type===1){if(y==="input"&&!("type" in A.attributes.map)){A.attr("type","text")}}}}});if(t.fix_list_elements){q.addNodeFilter("ul,ol",function(y){var z=y.length,A,x;while(z--){A=y[z];x=A.parent;if(x.name==="ul"||x.name==="ol"){if(A.prev&&A.prev.name==="li"){A.prev.append(A)}}}})}q.addAttributeFilter("data-mce-src,data-mce-href,data-mce-style,data-mce-selected,data-mce-expando,data-mce-type,data-mce-resize",function(x,y){var z=x.length;while(z--){x[z].attr(y,null)}});return{schema:u,addNodeFilter:q.addNodeFilter,addAttributeFilter:q.addAttributeFilter,serialize:function(y,C){var F=this,D,E,A,z,B,x;if(h.ie&&w.select("script,style,select,map").length>0){B=y.innerHTML;y=y.cloneNode(false);w.setHTML(y,B)}else{y=y.cloneNode(true)}D=document.implementation;if(D.createHTMLDocument){E=D.createHTMLDocument("");l(y.nodeName=="BODY"?y.childNodes:[y],function(G){E.body.appendChild(E.importNode(G,true))});if(y.nodeName!="BODY"){y=E.body.firstChild}else{y=E.body}A=w.doc;w.doc=E}C=C||{};C.format=C.format||"html";if(C.selection){C.forced_root_block=""}if(!C.no_events){C.node=y;F.onPreProcess(C)}x=q.parse(b(C.getInner?y.innerHTML:w.getOuterHTML(y)),C);k(x);z=new i(t,u);C.content=z.serialize(x);if(!C.cleanup){C.content=e.trim(C.content);C.content=C.content.replace(/\uFEFF/g,"")}if(!C.no_events){F.onPostProcess(C)}if(A){w.doc=A}C.node=null;return C.content},addRules:function(x){u.addValidElements(x)},setRules:function(x){u.setValidElements(x)},onPreProcess:function(x){if(s){s.fire("PreProcess",x)}},onPostProcess:function(x){if(s){s.fire("PostProcess",x)}},addTempAttr:v,trimHtml:r,getTrimmedContent:p}}});