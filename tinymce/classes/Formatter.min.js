define("tinymce/Formatter",["tinymce/dom/TreeWalker","tinymce/dom/RangeUtils","tinymce/dom/BookmarkManager","tinymce/dom/ElementUtils","tinymce/util/Tools","tinymce/fmt/Preview","tinymce/fmt/Hooks"],function(d,e,a,c,b,g,f){return function(ap){var ab={},i=ap.dom,C=ap.selection,Y=new e(i),k=ap.schema.isValidChild,S=i.isBlock,v=ap.settings.forced_root_block,E=i.nodeIndex,Q="\uFEFF",l=/^(src|href|style)$/,ak=false,M=true,aa,N,H=i.getContentEditable,R,t,V=a.isBookmarkNode;var ae=b.each,an=b.grep,z=b.walk,A=b.extend;function T(aq){if(aq.nodeType){aq=aq.nodeName}return !!ap.schema.getTextBlockElements()[aq.toLowerCase()]}function ag(aq){return/^(TH|TD)$/.test(aq.nodeName)}function ah(aq){return aq&&/^(IMG)$/.test(aq.nodeName)}function w(ar,aq){return i.getParents(ar,aq,i.getRoot())}function h(aq){return aq.nodeType===1&&aq.id==="_mce_caret"}function r(){u({valigntop:[{selector:"td,th",styles:{verticalAlign:"top"}}],valignmiddle:[{selector:"td,th",styles:{verticalAlign:"middle"}}],valignbottom:[{selector:"td,th",styles:{verticalAlign:"bottom"}}],alignleft:[{selector:"figure.image",collapsed:false,classes:"align-left",ceFalseOverride:true},{selector:"figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li",styles:{textAlign:"left"},inherit:false,defaultBlock:"div"},{selector:"img,table",collapsed:false,styles:{"float":"left"}}],aligncenter:[{selector:"figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li",styles:{textAlign:"center"},inherit:false,defaultBlock:"div"},{selector:"figure.image",collapsed:false,classes:"align-center",ceFalseOverride:true},{selector:"img",collapsed:false,styles:{display:"block",marginLeft:"auto",marginRight:"auto"}},{selector:"table",collapsed:false,styles:{marginLeft:"auto",marginRight:"auto"}}],alignright:[{selector:"figure.image",collapsed:false,classes:"align-right",ceFalseOverride:true},{selector:"figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li",styles:{textAlign:"right"},inherit:false,defaultBlock:"div"},{selector:"img,table",collapsed:false,styles:{"float":"right"}}],alignjustify:[{selector:"figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li",styles:{textAlign:"justify"},inherit:false,defaultBlock:"div"}],bold:[{inline:"strong",remove:"all"},{inline:"span",styles:{fontWeight:"bold"}},{inline:"b",remove:"all"}],italic:[{inline:"em",remove:"all"},{inline:"span",styles:{fontStyle:"italic"}},{inline:"i",remove:"all"}],underline:[{inline:"span",styles:{textDecoration:"underline"},exact:true},{inline:"u",remove:"all"}],strikethrough:[{inline:"span",styles:{textDecoration:"line-through"},exact:true},{inline:"strike",remove:"all"}],forecolor:{inline:"span",styles:{color:"%value"},links:true,remove_similar:true},hilitecolor:{inline:"span",styles:{backgroundColor:"%value"},links:true,remove_similar:true},fontname:{inline:"span",styles:{fontFamily:"%value"}},fontsize:{inline:"span",styles:{fontSize:"%value"}},fontsize_class:{inline:"span",attributes:{"class":"%value"}},blockquote:{block:"blockquote",wrapper:1,remove:"all"},subscript:{inline:"sub"},superscript:{inline:"sup"},code:{inline:"code"},link:{inline:"a",selector:"a",remove:"all",split:true,deep:true,onmatch:function(){return true},onformat:function(at,aq,ar){ae(ar,function(av,au){i.setAttrib(at,au,av)})}},removeformat:[{selector:"b,strong,em,i,font,u,strike,sub,sup,dfn,code,samp,kbd,variables,cite,mark,q,del,ins",remove:"all",split:true,expand:false,block_expand:true,deep:true},{selector:"span",attributes:["style","class"],remove:"empty",split:true,expand:false,deep:true},{selector:"*",attributes:["style","class"],split:false,expand:false,deep:true}]});ae("p h1 h2 h3 h4 h5 h6 div address pre div dt dd samp".split(/\s/),function(aq){u(aq,{block:aq,remove:"all"})});u(ap.settings.formats)}function aj(){ap.addShortcut("meta+b","bold_desc","Bold");ap.addShortcut("meta+i","italic_desc","Italic");ap.addShortcut("meta+u","underline_desc","Underline");for(var aq=1;aq<=6;aq++){ap.addShortcut("access+"+aq,"",["FormatBlock",false,"h"+aq])}ap.addShortcut("access+7","",["FormatBlock",false,"p"]);ap.addShortcut("access+8","",["FormatBlock",false,"div"]);ap.addShortcut("access+9","",["FormatBlock",false,"address"])}function ai(aq){return aq?ab[aq]:ab}function u(aq,ar){if(aq){if(typeof aq!=="string"){ae(aq,function(au,at){u(at,au)})}else{ar=ar.length?ar:[ar];ae(ar,function(at){if(at.deep===N){at.deep=!at.selector}if(at.split===N){at.split=!at.selector||at.inline}if(at.remove===N&&at.selector&&!at.inline){at.remove="none"}if(at.selector&&at.inline){at.mixed=true;at.block_expand=true}if(typeof at.classes==="string"){at.classes=at.classes.split(/\s+/)}});ab[aq]=ar}}}function I(aq){if(aq&&ab[aq]){delete ab[aq]}return ab}function q(at,aq){var au=ai(aq);if(au){for(var ar=0;ar<au.length;ar++){if(au[ar].inherit===false&&i.is(at,au[ar].selector)){return true}}}return false}function p(ar){var aq;ap.dom.getParent(ar,function(at){aq=ap.dom.getStyle(at,"text-decoration");return aq&&aq!=="none"});return aq}function W(aq){var ar;if(aq.nodeType===1&&aq.parentNode&&aq.parentNode.nodeType===1){ar=p(aq.parentNode);if(ap.dom.getStyle(aq,"color")&&ar){ap.dom.setStyle(aq,"text-decoration",ar)}else{if(ap.dom.getStyle(aq,"text-decoration")===ar){ap.dom.setStyle(aq,"text-decoration",null)}}}}function am(at,aB,av){var ax=ai(at),aC=ax[0],aA,ar,az=!av&&C.isCollapsed();function aq(aH,aF){aF=aF||aC;if(aH){if(aF.onformat){aF.onformat(aH,aF,aB,av)}ae(aF.styles,function(aJ,aI){i.setStyle(aH,aI,B(aJ,aB))});if(aF.styles){var aG=i.getAttrib(aH,"style");if(aG){aH.setAttribute("data-mce-style",aG)}}ae(aF.attributes,function(aJ,aI){i.setAttrib(aH,aI,B(aJ,aB))});ae(aF.classes,function(aI){aI=B(aI,aB);if(!i.hasClass(aH,aI)){i.addClass(aH,aI)}})}}function au(){function aH(aN,aL){var aM=new d(aL);for(av=aM.prev2();av;av=aM.prev2()){if(av.nodeType==3&&av.data.length>0){return av}if(av.childNodes.length>1||av==aN||av.tagName=="BR"){return av}}}var aG=ap.selection.getRng();var aK=aG.startContainer;var aF=aG.endContainer;if(aK!=aF&&aG.endOffset===0){var aJ=aH(aK,aF);var aI=aJ.nodeType==3?aJ.data.length:aJ.childNodes.length;aG.setEnd(aJ,aI)}return aG}function aD(aG,aI,aL){var aF=[],aK,aH,aJ=true;aK=aC.inline||aC.block;aH=i.create(aK);aq(aH);Y.walk(aG,function(aM){var aN;function aO(aP){var aU,aS,aQ,aR,aT;aT=aJ;aU=aP.nodeName.toLowerCase();aS=aP.parentNode.nodeName.toLowerCase();if(aP.nodeType===1&&H(aP)){aT=aJ;aJ=H(aP)==="true";aR=true}if(n(aU,"br")){aN=0;if(aC.block){i.remove(aP)}return}if(aC.wrapper&&J(aP,at,aB)){aN=0;return}if(aJ&&!aR&&aC.block&&!aC.wrapper&&T(aU)&&k(aS,aK)){aP=i.rename(aP,aK);aq(aP);aF.push(aP);aN=0;return}if(aC.selector){ae(ax,function(aV){if("collapsed" in aV&&aV.collapsed!==az){return}if(i.is(aP,aV.selector)&&!h(aP)){aq(aP,aV);aQ=true;return false}});if(!aC.inline||aQ){aN=0;return}}if(aJ&&!aR&&k(aK,aU)&&k(aS,aK)&&!(!aL&&aP.nodeType===3&&aP.nodeValue.length===1&&aP.nodeValue.charCodeAt(0)===65279)&&!h(aP)&&(!aC.inline||!S(aP))){if(!aN){aN=i.clone(aH,ak);aP.parentNode.insertBefore(aN,aP);aF.push(aN)}aN.appendChild(aP)}else{aN=0;ae(an(aP.childNodes),aO);if(aR){aJ=aT}aN=0}}ae(aM,aO)});if(aC.links===true){ae(aF,function(aM){function aN(aO){if(aO.nodeName==="A"){aq(aO,aC)}ae(an(aO.childNodes),aN)}aN(aM)})}ae(aF,function(aO){var aM;function aP(aR){var aQ=0;ae(aR.childNodes,function(aS){if(!m(aS)&&!V(aS)){aQ++}});return aQ}function aN(aQ){var aS,aR;ae(aQ.childNodes,function(aT){if(aT.nodeType==1&&!V(aT)&&!h(aT)){aS=aT;return ak}});if(aS&&!V(aS)&&o(aS,aC)){aR=i.clone(aS,ak);aq(aR);i.replace(aR,aQ,M);i.remove(aS,1)}return aR||aQ}aM=aP(aO);if((aF.length>1||!S(aO))&&aM===0){i.remove(aO,1);return}if(aC.inline||aC.wrapper){if(!aC.exact&&aM===1){aO=aN(aO)}ae(ax,function(aQ){ae(i.select(aQ.inline,aO),function(aR){if(V(aR)){return}ao(aQ,aB,aR,aQ.exact?aR:null)})});if(J(aO.parentNode,at,aB)){i.remove(aO,1);aO=0;return M}if(aC.merge_with_parents){i.getParent(aO.parentNode,function(aQ){if(J(aQ,at,aB)){i.remove(aO,1);aO=0;return M}})}if(aO&&aC.merge_siblings!==false){aO=F(O(aO),aO);aO=F(aO,O(aO,M))}}})}if(H(C.getNode())==="false"){av=C.getNode();for(var ay=0,aw=ax.length;ay<aw;ay++){if(ax[ay].ceFalseOverride&&i.is(av,ax[ay].selector)){aq(av,ax[ay]);return}}return}if(aC){if(av){if(av.nodeType){ar=i.createRng();ar.setStartBefore(av);ar.setEndAfter(av);aD(y(ar,ax),null,true)}else{aD(av,null,true)}}else{if(!az||!aC.inline||i.select("td[data-mce-selected],th[data-mce-selected]").length){var aE=ap.selection.getNode();if(!v&&ax[0].defaultBlock&&!i.getParent(aE,i.isBlock)){am(ax[0].defaultBlock)}ap.selection.setRng(au());aA=C.getBookmark();aD(y(C.getRng(M),ax),aA);if(aC.styles&&(aC.styles.color||aC.styles.textDecoration)){z(aE,W,"childNodes");W(aE)}C.moveToBookmark(aA);ac(C.getRng(M));ap.nodeChanged()}else{af("apply",at,aB)}}f.postProcess(at,ap)}}function L(at,aE,av,az){var ax=ai(at),aG=ax[0],aC,ar,aD=true;function au(aL){var aK,aJ,aI,aN,aM;if(aL.nodeType===1&&H(aL)){aN=aD;aD=H(aL)==="true";aM=true}aK=an(aL.childNodes);if(aD&&!aM){for(aJ=0,aI=ax.length;aJ<aI;aJ++){if(ao(ax[aJ],aE,aL,aL)){break}}}if(aG.deep){if(aK.length){for(aJ=0,aI=aK.length;aJ<aI;aJ++){au(aK[aJ])}if(aM){aD=aN}}}}function ay(aI){var aJ;ae(w(aI.parentNode).reverse(),function(aK){var aL;if(!aJ&&aK.id!="_start"&&aK.id!="_end"){aL=J(aK,at,aE,az);if(aL&&aL.split!==false){aJ=aK}}});return aJ}function aq(aM,aI,aN,aQ){var aR,aP,aO,aK,aL,aJ;if(aM){aJ=aM.parentNode;for(aR=aI.parentNode;aR&&aR!=aJ;aR=aR.parentNode){aP=i.clone(aR,ak);for(aL=0;aL<ax.length;aL++){if(ao(ax[aL],aE,aP,aP)){aP=0;break}}if(aP){if(aO){aP.appendChild(aO)}if(!aK){aK=aP}aO=aP}}if(aQ&&(!aG.mixed||!S(aM))){aI=i.split(aM,aI)}if(aO){aN.parentNode.insertBefore(aO,aN);aK.appendChild(aN)}}return aI}function aF(aI){return aq(ay(aI),aI,aI,true)}function aB(aK){var aJ=i.get(aK?"_start":"_end"),aI=aJ[aK?"firstChild":"lastChild"];if(V(aI)){aI=aI[aK?"firstChild":"lastChild"]}if(aI.nodeType==3&&aI.data.length===0){aI=aK?aJ.previousSibling||aJ.nextSibling:aJ.nextSibling||aJ.previousSibling}i.remove(aJ,true);return aI}function aH(aI){var aJ,aK;var aL=aI.commonAncestorContainer;aI=y(aI,ax,M);if(aG.split){aJ=X(aI,M);aK=X(aI);if(aJ!=aK){if(/^(TR|TH|TD)$/.test(aJ.nodeName)&&aJ.firstChild){if(aJ.nodeName=="TR"){aJ=aJ.firstChild.firstChild||aJ}else{aJ=aJ.firstChild||aJ}}if(aL&&/^T(HEAD|BODY|FOOT|R)$/.test(aL.nodeName)&&ag(aK)&&aK.firstChild){aK=aK.firstChild||aK}if(i.isChildOf(aJ,aK)&&!S(aK)&&!ag(aJ)&&!ag(aK)){aJ=ad(aJ,"span",{id:"_start","data-mce-type":"bookmark"});aF(aJ);aJ=aB(M);return}aJ=ad(aJ,"span",{id:"_start","data-mce-type":"bookmark"});aK=ad(aK,"span",{id:"_end","data-mce-type":"bookmark"});aF(aJ);aF(aK);aJ=aB(M);aK=aB()}else{aJ=aK=aF(aJ)}aI.startContainer=aJ.parentNode?aJ.parentNode:aJ;aI.startOffset=E(aJ);aI.endContainer=aK.parentNode?aK.parentNode:aK;aI.endOffset=E(aK)+1}Y.walk(aI,function(aM){ae(aM,function(aN){au(aN);if(aN.nodeType===1&&ap.dom.getStyle(aN,"text-decoration")==="underline"&&aN.parentNode&&p(aN.parentNode)==="underline"){ao({deep:false,exact:true,inline:"span",styles:{textDecoration:"underline"}},null,aN)}})})}if(av){if(av.nodeType){ar=i.createRng();ar.setStartBefore(av);ar.setEndAfter(av);aH(ar)}else{aH(av)}return}if(H(C.getNode())==="false"){av=C.getNode();for(var aA=0,aw=ax.length;aA<aw;aA++){if(ax[aA].ceFalseOverride){if(ao(ax[aA],aE,av,av)){break}}}return}if(!C.isCollapsed()||!aG.inline||i.select("td[data-mce-selected],th[data-mce-selected]").length){aC=C.getBookmark();aH(C.getRng(M));C.moveToBookmark(aC);if(aG.inline&&s(at,aE,C.getStart())){ac(C.getRng(true))}ap.nodeChanged()}else{af("remove",at,aE,az)}}function P(ar,au,at){var aq=ai(ar);if(s(ar,au,at)&&(!("toggle" in aq[0])||aq[0].toggle)){L(ar,au,at)}else{am(ar,au,at)}}function J(ar,aq,ax,av){var at=ai(aq),ay,aw,au;function az(aD,aF,aG){var aC,aE,aA=aF[aG],aB;if(aF.onmatch){return aF.onmatch(aD,aF,aG)}if(aA){if(aA.length===N){for(aC in aA){if(aA.hasOwnProperty(aC)){if(aG==="attributes"){aE=i.getAttrib(aD,aC)}else{aE=Z(aD,aC)}if(av&&!aE&&!aF.exact){return}if((!av||aF.exact)&&!n(aE,D(B(aA[aC],ax),aC))){return}}}}else{for(aB=0;aB<aA.length;aB++){if(aG==="attributes"?i.getAttrib(aD,aA[aB]):Z(aD,aA[aB])){return aF}}}}return aF}if(at&&ar){for(aw=0;aw<at.length;aw++){ay=at[aw];if(o(ar,ay)&&az(ar,ay,"attributes")&&az(ar,ay,"styles")){if((au=ay.classes)){for(aw=0;aw<au.length;aw++){if(!i.hasClass(ar,au[aw])){return}}}return ay}}}}function s(at,av,au){var ar;function aq(ax){var aw=i.getRoot();if(ax===aw){return false}ax=i.getParent(ax,function(ay){if(q(ay,at)){return true}return ay.parentNode===aw||!!J(ay,at,av,true)});return J(ax,at,av)}if(au){return aq(au)}au=C.getNode();if(aq(au)){return M}ar=C.getStart();if(ar!=au){if(aq(ar)){return M}}return ak}function G(av,au){var ar,at=[],aq={};ar=C.getStart();i.getParent(ar,function(ay){var ax,aw;for(ax=0;ax<av.length;ax++){aw=av[ax];if(!aq[aw]&&J(ay,aw,au)){aq[aw]=true;at.push(aw)}}},i.getRoot());return at}function K(av){var ax=ai(av),au,at,aw,ar,aq;if(ax){au=C.getStart();at=w(au);for(ar=ax.length-1;ar>=0;ar--){aq=ax[ar].selector;if(!aq||ax[ar].defaultBlock){return M}for(aw=at.length-1;aw>=0;aw--){if(i.is(at[aw],aq)){return M}}}}return ak}function U(aq,au,ar){var at;if(!aa){aa={};at={};ap.on("NodeChange",function(aw){var av=w(aw.element),ax={};av=b.grep(av,function(ay){return ay.nodeType==1&&!ay.getAttribute("data-mce-bogus")});ae(aa,function(ay,az){ae(av,function(aA){if(J(aA,az,{},ay.similar)){if(!at[az]){ae(ay,function(aB){aB(true,{node:aA,format:az,parents:av})});at[az]=ay}ax[az]=ay;return false}if(q(aA,az)){return false}})});ae(at,function(ay,az){if(!ax[az]){delete at[az];ae(ay,function(aA){aA(false,{node:aw.element,format:az,parents:av})})}})})}ae(aq.split(","),function(av){if(!aa[av]){aa[av]=[];aa[av].similar=ar}aa[av].push(au)});return this}function al(aq){return g.getCssText(ap,aq)}A(this,{get:ai,register:u,unregister:I,apply:am,remove:L,toggle:P,match:s,matchAll:G,matchNode:J,canApply:K,formatChanged:U,getCssText:al});r();aj();ap.on("BeforeGetContent",function(aq){if(t&&aq.format!="raw"){t()}});ap.on("mouseup keydown",function(aq){if(R){R(aq)}});function o(aq,ar){if(n(aq,ar.inline)){return M}if(n(aq,ar.block)){return M}if(ar.selector){return aq.nodeType==1&&i.is(aq,ar.selector)}}function n(ar,aq){ar=ar||"";aq=aq||"";ar=""+(ar.nodeName||ar);aq=""+(aq.nodeName||aq);return ar.toLowerCase()==aq.toLowerCase()}function Z(ar,aq){return D(i.getStyle(ar,aq),aq)}function D(ar,aq){if(aq=="color"||aq=="backgroundColor"){ar=i.toHex(ar)}if(aq=="fontWeight"&&ar==700){ar="bold"}if(aq=="fontFamily"){ar=ar.replace(/[\'\"]/g,"").replace(/,\s+/g,",")}return""+ar}function B(aq,ar){if(typeof aq!="string"){aq=aq(ar)}else{if(ar){aq=aq.replace(/%(\w+)/g,function(au,at){return ar[at]||au})}}return aq}function m(aq){return aq&&aq.nodeType===3&&/^([\t \r\n]+|)$/.test(aq.nodeValue)}function ad(at,ar,aq){var au=i.create(ar,aq);at.parentNode.insertBefore(au,at);au.appendChild(at);return au}function y(aq,aC,au){var aD,ax,aB,at=aq.startContainer,ay=aq.startOffset,aG=aq.endContainer,aA=aq.endOffset;function aE(aN){var aI,aL,aK,aJ,aH;aI=aL=aN?at:aG;aJ=aN?"previousSibling":"nextSibling";aH=i.getRoot();function aM(aO){return aO.nodeName=="BR"&&aO.getAttribute("data-mce-bogus")&&!aO.nextSibling}if(aI.nodeType==3&&!m(aI)){if(aN?ay>0:aA<aI.nodeValue.length){return aI}}while(true){if(!aC[0].block_expand&&S(aL)){return aL}for(aK=aL[aJ];aK;aK=aK[aJ]){if(!V(aK)&&!m(aK)&&!aM(aK)){return aL}}if(aL==aH||aL.parentNode==aH){aI=aL;break}aL=aL.parentNode}return aI}function aw(aH,aI){if(aI===N){aI=aH.nodeType===3?aH.length:aH.childNodes.length}while(aH&&aH.hasChildNodes()){aH=aH.childNodes[aI];if(aH){aI=aH.nodeType===3?aH.length:aH.childNodes.length}}return{node:aH,offset:aI}}if(at.nodeType==1&&at.hasChildNodes()){aD=at.childNodes.length-1;at=at.childNodes[ay>aD?aD:ay];if(at.nodeType==3){ay=0}}if(aG.nodeType==1&&aG.hasChildNodes()){aD=aG.childNodes.length-1;aG=aG.childNodes[aA>aD?aD:aA-1];if(aG.nodeType==3){aA=aG.nodeValue.length}}function aF(aI){var aH=aI;while(aH){if(aH.nodeType===1&&H(aH)){return H(aH)==="false"?aH:aI}aH=aH.parentNode}return aI}function az(aI,aM,aO){var aL,aJ,aN,aH;function aK(aQ,aS){var aT,aP,aR=aQ.nodeValue;if(typeof aS=="undefined"){aS=aO?aR.length:0}if(aO){aT=aR.lastIndexOf(" ",aS);aP=aR.lastIndexOf("\u00a0",aS);aT=aT>aP?aT:aP;if(aT!==-1&&!au){aT++}}else{aT=aR.indexOf(" ",aS);aP=aR.indexOf("\u00a0",aS);aT=aT!==-1&&(aP===-1||aT<aP)?aT:aP}return aT}if(aI.nodeType===3){aN=aK(aI,aM);if(aN!==-1){return{container:aI,offset:aN}}aH=aI}aL=new d(aI,i.getParent(aI,S)||ap.getBody());while((aJ=aL[aO?"prev":"next"]())){if(aJ.nodeType===3){aH=aJ;aN=aK(aJ);if(aN!==-1){return{container:aJ,offset:aN}}}else{if(S(aJ)){break}}}if(aH){if(aO){aM=0}else{aM=aH.length}return{container:aH,offset:aM}}}function av(aI,aH){var aJ,aK,aM,aL;if(aI.nodeType==3&&aI.nodeValue.length===0&&aI[aH]){aI=aI[aH]}aJ=w(aI);for(aK=0;aK<aJ.length;aK++){for(aM=0;aM<aC.length;aM++){aL=aC[aM];if("collapsed" in aL&&aL.collapsed!==aq.collapsed){continue}if(i.is(aJ[aK],aL.selector)){return aJ[aK]}}}return aI}function ar(aJ,aH){var aK,aI=i.getRoot();if(!aC[0].wrapper){aK=i.getParent(aJ,aC[0].block,aI)}if(!aK){aK=i.getParent(aJ.nodeType==3?aJ.parentNode:aJ,function(aL){return aL!=aI&&T(aL)})}if(aK&&aC[0].wrapper){aK=w(aK,"ul,ol").reverse()[0]||aK}if(!aK){aK=aJ;while(aK[aH]&&!S(aK[aH])){aK=aK[aH];if(n(aK,"br")){break}}}return aK||aJ}at=aF(at);aG=aF(aG);if(V(at.parentNode)||V(at)){at=V(at)?at:at.parentNode;at=at.nextSibling||at;if(at.nodeType==3){ay=0}}if(V(aG.parentNode)||V(aG)){aG=V(aG)?aG:aG.parentNode;aG=aG.previousSibling||aG;if(aG.nodeType==3){aA=aG.length}}if(aC[0].inline){if(aq.collapsed){aB=az(at,ay,true);if(aB){at=aB.container;ay=aB.offset}aB=az(aG,aA);if(aB){aG=aB.container;aA=aB.offset}}ax=aw(aG,aA);if(ax.node){while(ax.node&&ax.offset===0&&ax.node.previousSibling){ax=aw(ax.node.previousSibling)}if(ax.node&&ax.offset>0&&ax.node.nodeType===3&&ax.node.nodeValue.charAt(ax.offset-1)===" "){if(ax.offset>1){aG=ax.node;aG.splitText(ax.offset-1)}}}}if(aC[0].inline||aC[0].block_expand){if(!aC[0].inline||(at.nodeType!=3||ay===0)){at=aE(true)}if(!aC[0].inline||(aG.nodeType!=3||aA===aG.nodeValue.length)){aG=aE()}}if(aC[0].selector&&aC[0].expand!==ak&&!aC[0].inline){at=av(at,"previousSibling");aG=av(aG,"nextSibling")}if(aC[0].block||aC[0].selector){at=ar(at,"previousSibling");aG=ar(aG,"nextSibling");if(aC[0].block){if(!S(at)){at=aE(true)}if(!S(aG)){aG=aE()}}}if(at.nodeType==1){ay=E(at);at=at.parentNode}if(aG.nodeType==1){aA=E(aG)+1;aG=aG.parentNode}return{startContainer:at,startOffset:ay,endContainer:aG,endOffset:aA}}function j(aq,ar){return ar.links&&aq.tagName=="A"}function ao(ay,ax,av,aq){var au,ar,aw;if(!o(av,ay)&&!j(av,ay)){return ak}if(ay.remove!="all"){ae(ay.styles,function(aA,az){aA=D(B(aA,ax),az);if(typeof az==="number"){az=aA;aq=0}if(ay.remove_similar||(!aq||n(Z(aq,az),aA))){i.setStyle(av,az,"")}aw=1});if(aw&&i.getAttrib(av,"style")===""){av.removeAttribute("style");av.removeAttribute("data-mce-style")}ae(ay.attributes,function(aB,az){var aA;aB=B(aB,ax);if(typeof az==="number"){az=aB;aq=0}if(!aq||n(i.getAttrib(aq,az),aB)){if(az=="class"){aB=i.getAttrib(av,az);if(aB){aA="";ae(aB.split(/\s+/),function(aC){if(/mce\-\w+/.test(aC)){aA+=(aA?" ":"")+aC}});if(aA){i.setAttrib(av,az,aA);return}}}if(az=="class"){av.removeAttribute("className")}if(l.test(az)){av.removeAttribute("data-mce-"+az)}av.removeAttribute(az)}});ae(ay.classes,function(az){az=B(az,ax);if(!aq||i.hasClass(aq,az)){i.removeClass(av,az)}});ar=i.getAttribs(av);for(au=0;au<ar.length;au++){var at=ar[au].nodeName;if(at.indexOf("_")!==0&&at.indexOf("data-")!==0){return ak}}}if(ay.remove!="none"){x(av,ay);return M}}function x(at,au){var aq=at.parentNode,ar;function av(ax,aw,ay){ax=O(ax,aw,ay);return !ax||(ax.nodeName=="BR"||S(ax))}if(au.block){if(!v){if(S(at)&&!S(aq)){if(!av(at,ak)&&!av(at.firstChild,M,1)){at.insertBefore(i.create("br"),at.firstChild)}if(!av(at,M)&&!av(at.lastChild,ak,1)){at.appendChild(i.create("br"))}}}else{if(aq==i.getRoot()){if(!au.list_block||!n(at,au.list_block)){ae(an(at.childNodes),function(aw){if(k(v,aw.nodeName.toLowerCase())){if(!ar){ar=ad(aw,v);i.setAttribs(ar,ap.settings.forced_root_block_attrs)}else{ar.appendChild(aw)}}else{ar=0}})}}}}if(au.selector&&au.inline&&!n(au.inline,at)){return}i.remove(at,1)}function O(ar,aq,at){if(ar){aq=aq?"nextSibling":"previousSibling";for(ar=at?ar:ar[aq];ar;ar=ar[aq]){if(ar.nodeType==1||!m(ar)){return ar}}}}function F(av,au){var at,ar,aq=new c(i);function aw(ay,ax){for(at=ay;at;at=at[ax]){if(at.nodeType==3&&at.nodeValue.length!==0){return ay}if(at.nodeType==1&&!V(at)){return at}}return ay}if(av&&au){av=aw(av,"previousSibling");au=aw(au,"nextSibling");if(aq.compare(av,au)){for(at=av.nextSibling;at&&at!=au;){ar=at;at=at.nextSibling;av.appendChild(ar)}i.remove(au);ae(an(au.childNodes),function(ax){av.appendChild(ax)});return av}}return au}function X(ar,av){var aq,au,at;aq=ar[av?"startContainer":"endContainer"];au=ar[av?"startOffset":"endOffset"];if(aq.nodeType==1){at=aq.childNodes.length-1;if(!av&&au){au--}aq=aq.childNodes[au>at?at:au]}if(aq.nodeType===3&&av&&au>=aq.nodeValue.length){aq=new d(aq,ap.getBody()).next()||aq}if(aq.nodeType===3&&!av&&au===0){aq=new d(aq,ap.getBody()).prev()||aq}return aq}function af(aB,aq,az,av){var aC="_mce_caret",ar=ap.settings.caret_debug;function at(aG){var aF=i.create("span",{id:aC,"data-mce-bogus":true,style:ar?"color:red":""});if(aG){aF.appendChild(ap.getDoc().createTextNode(Q))}return aF}function aA(aG,aF){while(aG){if((aG.nodeType===3&&aG.nodeValue!==Q)||aG.childNodes.length>1){return false}if(aF&&aG.nodeType===1){aF.push(aG)}aG=aG.firstChild}return true}function ax(aF){while(aF){if(aF.id===aC){return aF}aF=aF.parentNode}}function aw(aF){var aG;if(aF){aG=new d(aF,aF);for(aF=aG.current();aF;aF=aG.next()){if(aF.nodeType===3){return aF}}}}function au(aH,aG){var aI,aF;if(!aH){aH=ax(C.getStart());if(!aH){while((aH=i.get(aC))){au(aH,false)}}}else{aF=C.getRng(true);if(aA(aH)){if(aG!==false){aF.setStartBefore(aH);aF.setEndBefore(aH)}i.remove(aH)}else{aI=aw(aH);if(aI.nodeValue.charAt(0)===Q){aI.deleteData(0,1);if(aF.startContainer==aI&&aF.startOffset>0){aF.setStart(aI,aF.startOffset-1)}if(aF.endContainer==aI&&aF.endOffset>0){aF.setEnd(aI,aF.endOffset-1)}}i.remove(aH,1)}C.setRng(aF)}}function ay(){var aH,aF,aL,aK,aI,aG,aJ;aH=C.getRng(true);aK=aH.startOffset;aG=aH.startContainer;aJ=aG.nodeValue;aF=ax(C.getStart());if(aF){aL=aw(aF)}if(aJ&&aK>0&&aK<aJ.length&&/\w/.test(aJ.charAt(aK))&&/\w/.test(aJ.charAt(aK-1))){aI=C.getBookmark();aH.collapse(true);aH=y(aH,ai(aq));aH=Y.split(aH);am(aq,az,aH);C.moveToBookmark(aI)}else{if(!aF||aL.nodeValue!==Q){aF=at(true);aL=aF.firstChild;aH.insertNode(aF);aK=1;am(aq,az,aF)}else{am(aq,az,aF)}C.setCursorLocation(aL,aK)}}function aD(){var aF=C.getRng(true),aG,aJ,aM,aL,aH,aP,aO=[],aK,aN;aG=aF.startContainer;aJ=aF.startOffset;aH=aG;if(aG.nodeType==3){if(aJ!=aG.nodeValue.length){aL=true}aH=aH.parentNode}while(aH){if(J(aH,aq,az,av)){aP=aH;break}if(aH.nextSibling){aL=true}aO.push(aH);aH=aH.parentNode}if(!aP){return}if(aL){aM=C.getBookmark();aF.collapse(true);aF=y(aF,ai(aq),true);aF=Y.split(aF);L(aq,az,aF);C.moveToBookmark(aM)}else{aN=at();aH=aN;for(aK=aO.length-1;aK>=0;aK--){aH.appendChild(i.clone(aO[aK],false));aH=aH.firstChild}aH.appendChild(i.doc.createTextNode(Q));aH=aH.firstChild;var aI=i.getParent(aP,T);if(aI&&i.isEmpty(aI)){aP.parentNode.replaceChild(aN,aP)}else{i.insertAfter(aN,aP)}C.setCursorLocation(aH,1);if(i.isEmpty(aP)){i.remove(aP)}}}function aE(){var aF;aF=ax(C.getStart());if(aF&&!i.isEmpty(aF)){z(aF,function(aG){if(aG.nodeType==1&&aG.id!==aC&&!i.isEmpty(aG)){i.setAttrib(aG,"data-mce-bogus",null)}},"childNodes")}}if(!ap._hasCaretEvents){t=function(){var aF=[],aG;if(aA(ax(C.getStart()),aF)){aG=aF.length;while(aG--){i.setAttrib(aF[aG],"data-mce-bogus","1")}}};R=function(aG){var aF=aG.keyCode;au();if(aF==8&&C.isCollapsed()&&C.getStart().innerHTML==Q){au(ax(C.getStart()))}if(aF==37||aF==39){au(ax(C.getStart()))}aE()};ap.on("SetContent",function(aF){if(aF.selection){aE()}});ap._hasCaretEvents=true}if(aB=="apply"){ay()}else{aD()}}function ac(ar){var aq=ar.startContainer,ay=ar.startOffset,au,ax,aw,at,av;if(ar.startContainer==ar.endContainer){if(ah(ar.startContainer.childNodes[ar.startOffset])){return}}if(aq.nodeType==3&&ay>=aq.nodeValue.length){ay=E(aq);aq=aq.parentNode;au=true}if(aq.nodeType==1){at=aq.childNodes;aq=at[Math.min(ay,at.length-1)];ax=new d(aq,i.getParent(aq,i.isBlock));if(ay>at.length-1||au){ax.next()}for(aw=ax.current();aw;aw=ax.next()){if(aw.nodeType==3&&!m(aw)){av=i.create("a",{"data-mce-bogus":"all"},Q);aw.parentNode.insertBefore(av,aw);ar.setStart(aw,0);C.setRng(ar);i.remove(av);return}}}}}});